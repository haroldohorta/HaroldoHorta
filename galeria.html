<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUR DAO - Galería</title>
    <style>
        body { background: #0a0a0a; color: #eee; font-family: 'Courier New', monospace; padding: 20px; }
        .nav-bar { margin-bottom: 20px; border-bottom: 1px dashed #444; padding-bottom: 10px; }
        button { background: #222; color: #fff; border: 1px solid #444; padding: 10px; cursor: pointer; font-family: monospace; }
        button:hover { background: #444; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .item { background: #111; border: 1px solid #222; padding: 15px; border-radius: 4px; display: flex; flex-direction: column; }
        img { width: 100%; height: 220px; object-fit: cover; border-radius: 2px; background: #222; }
        .info { margin-top: 12px; flex-grow: 1; }
        .id-text { font-size: 10px; color: #ff3333; font-weight: bold; display: block; margin-bottom: 5px; }
        .desc-text { font-size: 14px; color: #ddd; line-height: 1.5; border-left: 2px solid #444; padding-left: 10px; }
        .capa-tag { font-size: 9px; background: #333; padding: 2px 5px; border-radius: 3px; color: #aaa; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>
    <div class="nav-bar">
        <button onclick="window.location.href='index.html'">⬅ VOLVER AL ATLAS</button>
    </div>

    <h1 id="zona-titulo">...</h1>
    <div class="grid" id="grid"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let zonaBusqueda = urlParams.get('zona');

        if (!zonaBusqueda) {
            window.location.href = 'index.html';
        }

        document.getElementById('zona-titulo').innerText = "EXPEDICIÓN: " + zonaBusqueda.toUpperCase();

        fetch('puntos_mapa.json')
            .then(r => r.json())
            .then(fotos => {
                const container = document.getElementById('grid');
                
                // FILTRO INTELIGENTE: Busca la zona en cualquier parte de la ruta del thumb
                const filtradas = fotos.filter(f => {
                    const ruta = f.thumb.toLowerCase();
                    const zona = zonaBusqueda.toLowerCase();
                    return ruta.includes('/' + zona) || ruta.includes(zona + '/');
                });

                if (filtradas.length === 0) {
                    container.innerHTML = `<p>No se encontraron fotos para la zona: <b>${zonaBusqueda}</b></p>`;
                    return;
                }

                filtradas.forEach(f => {
                    // Usamos f.relato que es lo que viene en tu JSON de F:
                    const relato = f.relato && f.relato !== "Archivo SUR DAO" ? f.relato : "Esperando relato de Haroldo...";
                    
                    container.innerHTML += `
                        <div class="item">
                            <span class="capa-tag">${f.capa || 'General'}</span>
                            <a href="${f.thumb}" target="_blank">
                                <img src="${f.thumb}" alt="${f.id}" onerror="this.src='https://via.placeholder.com/300x200?text=Error+Ruta+Foto'">
                            </a>
                            <div class="info">
                                <span class="id-text">${f.id}</span>
                                <p class="desc-text">${relato}</p>
                            </div>
                        </div>`;
                });
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = "Error al cargar el archivo de datos.";
            });
    </script>
</body>
</html>
