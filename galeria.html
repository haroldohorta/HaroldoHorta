<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Haroldo Horta | 50 A√±os de Memoria Viva</title>
    
<<<<<<< HEAD
    <meta property="og:title" content="Atlas Haroldo Horta | 50 A√±os de Memoria Viva">
    <meta property="og:description" content="28TB de memoria fotogr√°fica: desde Nicaragua Sandinista hasta la Patagonia">
    <meta property="og:image" content="https://haroldohorta.github.io/atlas/fotos/panos/01_portada.webp">
    <meta property="og:url" content="https://haroldohorta.github.io/atlas/">
=======
    <!-- Open Graph -->
    <meta property="og:title" content="Archivo Haroldo Horta | Expediente Visual">
    <meta property="og:description" content="Galer√≠a georreferenciada de 50 a√±os de fotograf√≠a documental">
    <meta property="og:image" content="https://haroldohorta.github.io/atlas/fotos/panos/01_portada.webp">
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"/>
>>>>>>> 141045c (feat: agregados 45 puntos aereos geolocalizados automaticamente)
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Atlas Haroldo Horta">
    <meta name="twitter:description" content="50 a√±os de fotograf√≠a documental latinoamericana">
    <meta name="twitter:image" content="https://haroldohorta.github.io/atlas/fotos/panos/01_portada.webp">
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <style>
<<<<<<< HEAD
        /* --- ESTILO DARKROOM --- */
        body, html { margin: 0; padding: 0; height: 100%; background: #0f0f0f; font-family: 'Courier New', monospace; color: #ccc; }
        #map { height: 100%; width: 100%; background: #0f0f0f; }

        /* Estilos del Popup */
        .leaflet-popup-content-wrapper { background: #1a1a1a; color: #eee; border: 1px solid #ff9f1c; border-radius: 0; padding: 0; }
        .leaflet-popup-tip { background: #1a1a1a; border-top: 1px solid #ff9f1c; }
        .popup-img { width: 100%; height: 140px; object-fit: cover; border-bottom: 1px solid #ff9f1c; display: block; background: #000; }
        
        /* Bot√≥n del Popup */
        .btn-portafolio {
            width: 100%; background: #222; color: #ff9f1c; padding: 10px; cursor: pointer;
            text-transform: uppercase; font-weight: bold; font-size: 11px; text-decoration: none;
            display: block; text-align: center; box-sizing: border-box; transition: 0.3s;
=======
        body { 
            background: #0b0b0b; color: #fff; 
            font-family: 'Helvetica Neue', sans-serif; 
            margin: 0; padding: 20px; 
        }
        
        /* Cabecera */
        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #ff9f1c; padding-bottom: 15px; margin-bottom: 30px;
        }
        h1 { 
            margin: 0; color: #ff9f1c; letter-spacing: 2px; 
            text-transform: uppercase; font-size: 24px; 
        }
        
        .btn-volver {
            text-decoration: none; color: #aaa; border: 1px solid #444; 
            padding: 8px 16px; transition: 0.3s; font-size: 12px; 
            text-transform: uppercase; border-radius: 4px;
        }
        .btn-volver:hover { color: #fff; border-color: #ff9f1c; background: #222; }

        /* Stats bar */
        .stats-bar {
            background: #1a1a1a; border: 1px solid #333; 
            padding: 15px; margin-bottom: 30px; border-radius: 4px;
            display: flex; justify-content: space-around; align-items: center;
            flex-wrap: wrap;
        }
        .stat-item {
            text-align: center; padding: 10px;
        }
        .stat-number {
            font-size: 28px; color: #ff9f1c; font-weight: bold;
        }
        .stat-label {
            font-size: 10px; color: #888; text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* MASONRY GRID */
        .gallery-container {
            column-count: 4;
            column-gap: 15px;
        }
        @media (max-width: 1200px) { .gallery-container { column-count: 3; } }
        @media (max-width: 768px) { .gallery-container { column-count: 2; } }
        @media (max-width: 480px) { .gallery-container { column-count: 1; } }

        .gallery-item {
            break-inside: avoid; margin-bottom: 15px;
            position: relative; transition: transform 0.3s ease;
            cursor: zoom-in; background: #1a1a1a;
            border: 1px solid #333; border-radius: 4px;
            overflow: hidden;
        }
        .gallery-item:hover { 
            transform: scale(1.02); 
            z-index: 10; 
            border-color: #ff9f1c;
        }
        
        .gallery-item img {
            width: 100%; height: auto; display: block;
>>>>>>> 141045c (feat: agregados 45 puntos aereos geolocalizados automaticamente)
        }
        .btn-portafolio:hover { background: #ff9f1c; color: #000; }

<<<<<<< HEAD
        /* --- PERSONALIZACI√ìN DE LAS BURBUJAS (CLUSTERS) --- */
        .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large {
            background-color: rgba(255, 159, 28, 0.2) !important;
        }
        .marker-cluster div {
            background-color: #000 !important;
            color: #ff9f1c !important;
            border: 1px solid #ff9f1c;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Leyenda Actualizada */
        .legend { 
            position: absolute; bottom: 30px; left: 30px; 
            background: rgba(0,0,0,0.8); border: 1px solid #444; 
            padding: 10px; z-index: 1000; font-size: 11px; 
            border-radius: 4px;
        }
        .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }

        /* Loading Screen */
        #loading {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #0f0f0f; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }
        #loading .spinner {
            font-size: 50px; margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loading .text {
            color: #ff9f1c; font-size: 14px; text-transform: uppercase;
            letter-spacing: 2px;
=======
        /* Info overlay */
        .info-overlay {
            padding: 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            position: absolute; bottom: 0; left: 0; right: 0;
            opacity: 0; transition: 0.3s;
        }
        .gallery-item:hover .info-overlay { opacity: 1; }
        
        .foto-id {
            font-size: 9px; color: #666; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        .foto-titulo {
            font-size: 12px; color: #ff9f1c; 
            font-weight: bold; margin: 3px 0;
        }
        .foto-rating {
            font-size: 14px; margin: 3px 0;
        }

        /* FANCYBOX CUSTOM CAPTION */
        .fancybox__caption {
            background: rgba(0, 0, 0, 0.95) !important;
            color: #eee !important;
            padding: 20px !important;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Loading */
        #loading {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; z-index: 999;
        }
        .spinner { font-size: 40px; animation: spin 2s linear infinite; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
>>>>>>> 141045c (feat: agregados 45 puntos aereos geolocalizados automaticamente)
        }
    </style>
</head>
<body>

<<<<<<< HEAD
<div id="loading">
    <div class="spinner">üì∑</div>
    <div class="text">Cargando Atlas...</div>
</div>

<div id="map"></div>

<div class="legend">
    <div><span class="dot" style="background:#b366ff;"></span> NARRATIVA</div>
    <div><span class="dot" style="background:#ff4d4d;"></span> CR√ìNICA</div>
    <div><span class="dot" style="background:#4d94ff;"></span> A√âREO</div>
    <div><span class="dot" style="background:#ffdb4d;"></span> PATRIMONIO</div>
    <div style="margin-top:5px; color:#777;">* Haz clic en los n√∫meros para desplegar</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
    // 1. Mapa Base
    const map = L.map('map').setView([-22, -68], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'SUR DAO | Haroldo Horta', 
        maxZoom: 19
    }).addTo(map);

    // 2. Grupo de Clusters
    const markers = L.markerClusterGroup({
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        animate: true
    });

    // --- L√ìGICA DE COLORES ACTUALIZADA ---
    const getStyle = (capa) => {
        if(!capa) return "#fff";
        // Prioridad a la Narrativa (Historias destacadas)
        if(capa.includes('Narrativa') || capa.includes('Relato')) return "#b366ff"; // Violeta M√≠stico
        
        if(capa.includes('Cr√≥nica')) return "#ff4d4d";   // Rojo Sangre
        if(capa.includes('A√©reo') || capa.includes('fly')) return "#4d94ff"; // Azul Cielo
        if(capa.includes('Patrimonio') || capa.includes('N√≥mada')) return "#ffdb4d"; // Amarillo Oro
        
        return "#ffffff"; // Blanco por defecto
    };

    // 3. Cargar datos
    fetch('data/puntos_mapa.json')
        .then(res => res.json())
        .then(data => {
            console.log("Cargando puntos:", data.length);
            
            // Remover loading screen
            const loadingEl = document.getElementById('loading');
            if(loadingEl) loadingEl.remove();
            
            data.forEach(punto => {
                if (!punto.lat || !punto.lon) return;

                const color = getStyle(punto.capa);
                
                const marker = L.circleMarker([punto.lat, punto.lon], {
                    radius: 8,
                    fillColor: color,
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.9
                });

                const zonaTitulo = punto.zona ? punto.zona.toUpperCase() : 'ZONA';
                marker.bindPopup(`
                    <div style="min-width: 180px; text-align: center;">
                        <div style="font-size:9px; color:#888; margin-bottom:5px; text-transform:uppercase;">
                            ${punto.capa || 'ARCHIVO'}
                        </div>
                        <h3 style="margin: 5px 0; color: #ff9f1c;">${zonaTitulo}</h3>
                        <img src="${punto.thumb}" class="popup-img" onerror="this.style.display='none'">
                        <div style="font-size:9px; color:#666; margin:8px 0;">${punto.id || ''}</div>
                        <a href="galeria.html?zona=${punto.zona}" class="btn-portafolio">ABRIR EXPEDIENTE üìÇ</a>
                    </div>
                `);

                markers.addLayer(marker);
=======
    <div id="loading">
        <div class="spinner">üì∑</div>
        <div style="color:#ff9f1c; margin-top:10px;">CARGANDO EXPEDIENTE...</div>
    </div>

    <header>
        <h1 id="titulo-zona">ARCHIVO GLOBAL</h1>
        <a href="index.html" class="btn-volver">‚Üê Volver al Mapa</a>
    </header>

    <div class="stats-bar" id="stats">
        <div class="stat-item">
            <div class="stat-number" id="total-fotos">0</div>
            <div class="stat-label">Fotograf√≠as</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="periodo">‚Äî</div>
            <div class="stat-label">Per√≠odo</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="rating-promedio">‚Äî</div>
            <div class="stat-label">Rating Promedio</div>
        </div>
    </div>

    <div class="gallery-container" id="galeria"></div>

    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <script>
        // Funci√≥n para generar estrellas
        function generarEstrellas(rating) {
            if (!rating) return '';
            const llenas = '‚≠ê'.repeat(rating);
            const vacias = '‚òÜ'.repeat(5 - rating);
            return llenas + vacias;
        }

        // Funci√≥n para formatear fecha
        function formatearFecha(fecha) {
            if (!fecha) return '';
            const date = new Date(fecha);
            return date.toLocaleDateString('es-ES', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Funci√≥n para generar caption rico
        function generarCaption(foto) {
            let html = `
                <div style="text-align: left; font-family: 'Helvetica Neue', sans-serif;">
                    <div style="border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 10px;">
                        <div style="font-size: 18px; color: #ff9f1c; font-weight: bold; margin-bottom: 5px;">
                            ${foto.titulo || foto.zona}
                        </div>
                        <div style="font-size: 20px; margin-bottom: 5px;">
                            ${generarEstrellas(foto.rating)}
                        </div>
                        <div style="font-size: 11px; color: #888;">
                            ${formatearFecha(foto.fecha)} | ${foto.id}
                        </div>
                    </div>
            `;

            // Relato (lo m√°s importante)
            if (foto.relato) {
                html += `
                    <div style="margin-bottom: 15px; line-height: 1.6; font-size: 13px; color: #ddd; font-style: italic;">
                        "${foto.relato}"
                    </div>
                `;
            }

            // Descripci√≥n
            if (foto.descripcion) {
                html += `
                    <div style="margin-bottom: 15px; line-height: 1.5; font-size: 12px; color: #ccc;">
                        ${foto.descripcion}
                    </div>
                `;
            }

            // Metadata t√©cnica
            if (foto.camara || foto.lente || foto.iso) {
                html += `
                    <div style="background: #0f0f0f; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        <div style="font-size: 10px; color: #ff9f1c; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;">
                            üì∑ Metadata T√©cnica
                        </div>
                        ${foto.camara ? `<div style="font-size: 11px; color: #aaa;">C√°mara: ${foto.camara}</div>` : ''}
                        ${foto.lente ? `<div style="font-size: 11px; color: #aaa;">Lente: ${foto.lente}</div>` : ''}
                        ${foto.iso ? `<div style="font-size: 11px; color: #aaa;">ISO: ${foto.iso} | ${foto.exposicion || ''}</div>` : ''}
                    </div>
                `;
            }

            // Keywords
            if (foto.keywords && foto.keywords.length > 0) {
                html += `
                    <div style="margin-top: 10px;">
                        ${foto.keywords.map(tag => 
                            `<span style="display:inline-block; background:#222; color:#ff9f1c; 
                                    padding:3px 8px; margin:2px; font-size:9px; border-radius:3px; 
                                    border:1px solid #444; text-transform:uppercase;">
                                #${tag}
                            </span>`
                        ).join('')}
                    </div>
                `;
            }

            html += `</div>`;
            return html;
        }

        // Cargar Datos
        const params = new URLSearchParams(window.location.search);
        const zona = params.get('zona');
        
        fetch('data/puntos_mapa.json')
            .then(res => res.json())
            .then(data => {
                // Remover loading
                document.getElementById('loading').remove();

                const contenedor = document.getElementById('galeria');
                
                // Filtrar por zona
                const fotos = data.filter(item => !zona || item.zona === zona);

                // Actualizar t√≠tulo
                document.getElementById('titulo-zona').innerText = zona ? `EXPEDIENTE: ${zona.toUpperCase()}` : 'ARCHIVO GLOBAL';

                // Stats
                document.getElementById('total-fotos').innerText = fotos.length;
                
                // Calcular per√≠odo
                const fechas = fotos.filter(f => f.fecha).map(f => new Date(f.fecha).getFullYear());
                if (fechas.length > 0) {
                    const min = Math.min(...fechas);
                    const max = Math.max(...fechas);
                    document.getElementById('periodo').innerText = min === max ? min : `${min}-${max}`;
                }

                // Rating promedio
                const ratings = fotos.filter(f => f.rating).map(f => f.rating);
                if (ratings.length > 0) {
                    const promedio = (ratings.reduce((a,b) => a+b, 0) / ratings.length).toFixed(1);
                    document.getElementById('rating-promedio').innerText = `${promedio} ‚≠ê`;
                }

                // Verificar si hay fotos
                if (fotos.length === 0) {
                    contenedor.innerHTML = `
                        <p style="text-align:center; color:#666; margin-top:50px;">
                            No hay im√°genes disponibles para esta zona.
                        </p>
                    `;
                    return;
                }

                // Renderizar galer√≠a
                fotos.forEach(foto => {
                    const link = document.createElement('a');
                    link.className = 'gallery-item';
                    link.href = foto.full || foto.thumb;
                    link.setAttribute('data-fancybox', 'gallery');
                    link.setAttribute('data-caption', generarCaption(foto));
                    
                    link.innerHTML = `
                        <img src="${foto.thumb}" loading="lazy" alt="${foto.titulo || foto.zona}">
                        <div class="info-overlay">
                            <div class="foto-id">${foto.id}</div>
                            <div class="foto-titulo">${foto.titulo || foto.zona}</div>
                            <div class="foto-rating">${generarEstrellas(foto.rating)}</div>
                        </div>
                    `;
                    
                    contenedor.appendChild(link);
                });

                // Configurar Fancybox
                Fancybox.bind("[data-fancybox]", {
                    animated: true,
                    showClass: "f-fadeIn",
                    hideClass: "f-fadeOut",
                    Toolbar: {
                        display: {
                            left: ["infobar"],
                            middle: [],
                            right: ["slideshow", "thumbs", "close"],
                        },
                    },
                    // Hacer que el caption se vea bien
                    caption: function (fancybox, carousel, slide) {
                        return slide.$trigger.getAttribute('data-caption');
                    }
                });
            })
            .catch(err => {
                document.getElementById('loading').innerHTML = `
                    <div style="color:#ff4d4d;">‚ö†Ô∏è Error al cargar el expediente</div>
                    <div style="color:#666; font-size:10px; margin-top:10px;">
                        ${err.message}
                    </div>
                `;
                console.error("Error:", err);
>>>>>>> 141045c (feat: agregados 45 puntos aereos geolocalizados automaticamente)
            });

            map.addLayer(markers);
        })
        .catch(err => {
            console.error("Error cargando datos:", err);
            const loadingEl = document.getElementById('loading');
            if(loadingEl) {
                loadingEl.innerHTML = `
                    <div class="spinner">‚ö†Ô∏è</div>
                    <div class="text" style="color:#ff4d4d;">Error al cargar el Atlas</div>
                    <div style="color:#666; font-size:10px; margin-top:10px;">
                        Verifica que existe: data/puntos_mapa.json
                    </div>
                `;
            }
        });
</script>

</body>
</html>
